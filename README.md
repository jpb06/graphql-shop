# graphql-shop

Toying with graphql by coding a simple webshop app.

<!-- readme-package-icons start -->

<p align="left"><a href="https://docs.github.com/en/actions" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/GithubActions-Dark.svg" /></a>&nbsp;<a href="https://www.typescriptlang.org/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/TypeScript.svg" /></a>&nbsp;<a href="https://nodejs.org/en/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/NodeJS-Dark.svg" /></a>&nbsp;<a href="https://pnpm.io/motivation" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Pnpm-Dark.svg" /></a>&nbsp;<a href="https://fly.io/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/FlyIo-Dark.svg" /></a>&nbsp;<a href="https://docs.docker.com" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Docker.svg" /></a>&nbsp;<a href="https://www.postgresql.org/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/PostgreSQL-Dark.svg" /></a>&nbsp;<a href="https://www.apollographql.com/docs/react/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Apollo.svg" /></a>&nbsp;<a href="https://babeljs.io/docs/en/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Babel-Dark.svg" /></a>&nbsp;<a href="https://docs.cypress.io/guides/overview/why-cypress" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Cypress-Dark.svg" /></a>&nbsp;<a href="https://eslint.org/docs/latest/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Eslint-Dark.svg" /></a>&nbsp;<a href="https://expressjs.com/en/starter/installing.html" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/ExpressJS-Dark.svg" /></a>&nbsp;<a href="https://fakerjs.dev/guide/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Faker-Dark.svg" /></a>&nbsp;<a href="https://graphql.org/learn/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/GraphQL-Dark.svg" /></a>&nbsp;<a href="https://www.i18next.com/overview/getting-started" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/I18next-Dark.svg" /></a>&nbsp;<a href="https://jestjs.io/docs/getting-started" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Jest.svg" /></a>&nbsp;<a href="https://jotai.org/docs/introduction" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Jotai-Dark.svg" /></a>&nbsp;<a href="https://jwt.io" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Jwt-Dark.svg" /></a>&nbsp;<a href="https://docs.nestjs.com" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/NestJS-Dark.svg" /></a>&nbsp;<a href="https://nextjs.org/docs/getting-started" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/NextJS-Dark.svg" /></a>&nbsp;<a href="https://nx.dev/getting-started/intro" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Nx-Dark.svg" /></a>&nbsp;<a href="https://www.passportjs.org/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Passport-Dark.svg" /></a>&nbsp;<a href="https://prettier.io/docs/en/index.html" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Prettier-Dark.svg" /></a>&nbsp;<a href="https://www.prisma.io/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Prisma.svg" /></a>&nbsp;<a href="https://reactjs.org/docs/getting-started.html" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/React-Dark.svg" /></a>&nbsp;<a href="https://react-hook-form.com/get-started" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/ReactHookForm-Dark.svg" /></a>&nbsp;<a href="https://tanstack.com/query/v4/docs/overview" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/ReactQuery-Dark.svg" /></a>&nbsp;<a href="https://rxjs.dev/guide/overview" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Rxjs-Dark.svg" /></a>&nbsp;<a href="https://tailwindcss.com/docs/installation" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/TailwindCSS-Dark.svg" /></a>&nbsp;<a href="https://testing-library.com/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/TestingLibrary-Dark.svg" /></a>&nbsp;<a href="https://github.com/typestack" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/TypeStack-Dark.svg" /></a>&nbsp;<a href="https://webpack.js.org/concepts/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Webpack-Dark.svg" /></a>&nbsp;<a href="https://github.com/colinhacks/zod#introduction" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Zod-Dark.svg" /></a>&nbsp;<a href="https://graphql.org/learn/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/GrapgqlCodegen-Dark.svg" /></a></p>

<!-- readme-package-icons end -->

## âš¡ Quickstart

### ðŸ”¶ Launching database instance

```bash
pnpm docker-db
```

### ðŸ”¶ Seeding database

```bash
pnpm docker-db-seed
```

### ðŸ”¶ Launching frontend and backend services

```bash
pnpm dev
```

### ðŸ”¶ Launching tests

```bash
pnpm nx run-many --target=test --all
```

## âš¡ Subject

The purpose of our app will be to sell products to customers by allowing them to place orders. This gives us several features to address, typical for an online webapp store:

- Products display, filtering and actions
- Shopping cart
- Login / Signup
- Shipping options
- Payment mockup
- Orders history

## âš¡ Stack

### ðŸ”¶ Tooling - [pnpm](https://pnpm.io) | [nx](https://nx.dev/getting-started/intro) | [graphql-codegen](https://github.com/dotansimha/graphql-code-generator)

#### ðŸ§¿ nx

nx is a great tool for monorepos. It will allow us to define both our backend and our frontend in the same repo. We will also split up the codebase further with the use of nx libraries.

![nx graph](./docs/nx-graph.png)

#### ðŸ§¿ Graphql Codegen

We are using a tool to generate code based on react-query from the backend graphql schema and graphql code defined in our frontend. Here is a little schema:

![codegen](./docs/graphql-codegen.png)

- On the backend, our graphql schema is an autogenerated file from nest graphql module, which based on apollo server.
- On the frontend, we start by defining atomic queries/mutation in graphql; these files are pulled by the codegen tool to autogenerate react-query queries/mutations, along with their related types.

Generation is as simple as executing this command:

```bash
pnpm nx fetch lib-graphql-codegen
```

### ðŸ”¶ Backend - [nest](https://docs.nestjs.com) | [prisma](https://www.prisma.io/docs/getting-started)

We are using nest graphql module to define what will be exposed on the graphql schema. Nest module is very similar to [typegraphql](https://typegraphql.com): we define resolvers that will contain functions annotated with decorators defined in `@nestjs/graphql` to define our queries, mutations and fields resolution.

These resolvers rely on a service layer that is responsible for the interaction with our database, using prisma ORM.

### ðŸ”¶ Frontend - [next](https://nextjs.org/docs/getting-started) | [jotai](https://jotai.org/docs/introduction) | [react-query](https://tanstack.com/query/v4/docs/overview) | [tailwind](https://tailwindcss.com/docs/installation)

As for frontend, the api layer is already resolved for us thanks to the codegen mentioned earlier. We do need some transient state however. I elected jotai for this, which is very flexible, simple and elegant.

All we have to do is to define atomic state that can then be consumed anywhere in the components tree.

### ðŸ”¶ Deployment - [docker](https://docs.docker.com) | [vercel](https://vercel.com/docs) | [fly.io](https://fly.io/docs/)

Frontend deployment is really easy thans to vercel. However, when it comes to backend, we have several choices, some more onerous than others. I personally chose fly.io as a replacement for heroku free dynos.

## âš¡ Database

![Diagram](./docs/dbase-model.png)

### ðŸ”¶ Creating a new migration

```bash
pnpm prisma-migrate <migration_name>
```

### ðŸ”¶ Seeding database manually

```bash
pnpm prisma-seed
```
