// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("NX_DATABASE_URL")
}

model Category {
  id Int @id @default(autoincrement())

  name String

  Products Product[]
}

model Product {
  id         Int @id @default(autoincrement())
  idCategory Int @map("Category")

  name        String
  description String
  price       Decimal
  image       String
  stock       Int

  Category   Category?    @relation(fields: [idCategory], references: [id])
  OrderItems OrderItems[]
}

enum Role {
  USER
  ADMIN
}

model User {
  id Int @id @default(autoincrement())

  email     String   @unique
  lastName  String
  firstName String
  password  String
  joinDate  DateTime @default(now())
  role      Role     @default(USER)

  JoinUserAddress JoinUserAddress[]
  Order           Order[]
}

model Address {
  id Int @id @default(autoincrement())

  street  String
  zipCode String
  city    String
  country String

  JoinUserAddress JoinUserAddress[]
}

model JoinUserAddress {
  id        Int @id @default(autoincrement())
  idUser    Int
  idAddress Int

  createdAt DateTime @default(now())

  User    User    @relation(fields: [idUser], references: [id])
  Address Address @relation(fields: [idAddress], references: [id])
}

model Order {
  id           Int @id @default(autoincrement())
  idOrderItems Int
  idUser       Int
  idCreditCard Int

  createdAt DateTime @default(now())

  OrderItems OrderItems @relation(fields: [idOrderItems], references: [id])
  User       User       @relation(fields: [idUser], references: [id])
  CreditCard CreditCard @relation(fields: [idCreditCard], references: [id])
}

model OrderItems {
  id        Int @id @default(autoincrement())
  idProduct Int

  Product Product @relation(fields: [idProduct], references: [id])
  Order   Order[]
}

model CreditCard {
  id      Int    @id @default(autoincrement())
  number  String
  expires String
  cvc     String

  Order Order[]
}
